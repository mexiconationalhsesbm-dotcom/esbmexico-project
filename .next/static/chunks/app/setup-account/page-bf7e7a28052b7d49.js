(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1358],{285:(e,s,t)=>{"use strict";t.d(s,{$:()=>d,r:()=>o});var r=t(5155),a=t(2115),n=t(9708),l=t(2085),i=t(6707);let o=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,s)=>{let{className:t,variant:a,size:l,asChild:d=!1,...u}=e,c=d?n.DX:"button";return(0,r.jsx)(c,{className:(0,i.cn)(o({variant:a,size:l,className:t})),ref:s,...u})});d.displayName="Button"},1108:(e,s,t)=>{"use strict";t.d(s,{N:()=>a});var r=t(1537);t(9509);let a=(0,r.UU)("https://kegskzgwkhltieyddbby.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlZ3Nremd3a2hsdGlleWRkYmJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTMyMzQsImV4cCI6MjA2Mzg2OTIzNH0.daWkoPRZZsqlhRINmeWDSe1cm6JwRP7rf_jy1npw-7Q")},2523:(e,s,t)=>{"use strict";t.d(s,{p:()=>l});var r=t(5155),a=t(2115),n=t(6707);let l=a.forwardRef((e,s)=>{let{className:t,type:a,...l}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...l})});l.displayName="Input"},5057:(e,s,t)=>{"use strict";t.d(s,{J:()=>d});var r=t(5155),a=t(2115),n=t(860),l=t(2085),i=t(6707);let o=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(n.b,{ref:s,className:(0,i.cn)(o(),t),...a})});d.displayName=n.b.displayName},6695:(e,s,t)=>{"use strict";t.d(s,{BT:()=>d,Wu:()=>u,ZB:()=>o,Zp:()=>l,aR:()=>i});var r=t(5155),a=t(2115),n=t(6707);let l=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});l.displayName="Card";let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})});i.displayName="CardHeader";let o=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});o.displayName="CardTitle";let d=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})});d.displayName="CardDescription";let u=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",t),...a})});u.displayName="CardContent",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})}).displayName="CardFooter"},6707:(e,s,t)=>{"use strict";t.d(s,{cn:()=>n});var r=t(2596),a=t(9688);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.QP)((0,r.$)(s))}},7723:(e,s,t)=>{Promise.resolve().then(t.bind(t,9056))},8437:(e,s,t)=>{"use strict";t.d(s,{A:()=>d,AuthProvider:()=>o});var r=t(5155),a=t(2115),n=t(5695),l=t(1108);let i=(0,a.createContext)(void 0);function o(e){var s,t,o,d;let{children:u}=e,[c,m]=(0,a.useState)(null),[f,p]=(0,a.useState)(null),[h,g]=(0,a.useState)(null),[w,x]=(0,a.useState)(!0),v=(0,n.useRouter)(),b=(0,n.usePathname)();(0,a.useEffect)(()=>{(async()=>{x(!0);try{var e,s;let{data:t}=await l.N.auth.getSession();if(g(t.session),m((null==(e=t.session)?void 0:e.user)||null),null==(s=t.session)?void 0:s.user){let{data:e}=await l.N.from("admins").select("\n              id,\n              email,\n              full_name,\n              assigned_dimension_id,\n              created_at,\n              updated_at,\n              status,\n              last_active_at,\n              role:roles(id, name)\n            ").eq("id",t.session.user.id).single();e?p({...e,role:e.role&&e.role.length>0?e.role[0]:null}):p(null)}}catch(e){console.error("Error getting initial session:",e)}finally{x(!1)}})();let{data:e}=l.N.auth.onAuthStateChange(async(e,s)=>{if(g(s),m((null==s?void 0:s.user)||null),null==s?void 0:s.user){let{data:e}=await l.N.from("admins").select("*").eq("id",s.user.id).single();p(e),await l.N.from("admins").update({last_active_at:new Date().toISOString()}).eq("id",s.user.id)}else p(null);x(!1)});return()=>{e.subscription.unsubscribe()}},[b,v]);let y=async(e,s)=>{let{error:t}=await l.N.auth.signInWithPassword({email:e,password:s});return{error:t}},N=async(e,s,t)=>{let{data:r,error:a}=await l.N.auth.signUp({email:e,password:s});return{data:r,error:a}},j=async()=>{await l.N.auth.signOut(),v.push("/login")},P=async e=>{let{error:s}=await l.N.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});return{error:s}},S=async e=>{let{error:s}=await l.N.auth.updateUser({password:e});return{error:s}},C=async(e,s)=>{try{let t=await fetch("/api/auth/send-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,userId:s})});if(!t.ok)return{error:(await t.json()).error||"Failed to send OTP"};return{error:null}}catch(e){return{error:e.message||"Failed to send OTP"}}},I=async(e,s,t)=>{try{let r=await fetch("/api/auth/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,userId:s,otp:t})});if(!r.ok)return{error:(await r.json()).error||"Failed to verify OTP"};return{error:null}}catch(e){return{error:e.message||"Failed to verify OTP"}}},O=!w&&null!==f,_=(null==f||null==(s=f.role)?void 0:s.name)==="Master Admin",k=(null==f||null==(t=f.role)?void 0:t.name)==="Overall Focal Person",A=(null==f||null==(o=f.role)?void 0:o.name)==="Dimension Leader",R=(null==f||null==(d=f.role)?void 0:d.name)==="Dimension Member",J=(null==f?void 0:f.assigned_dimension_id)||null;return(0,r.jsx)(i.Provider,{value:{user:c,admin:f,session:h,rolesReady:O,isLoading:w,signIn:y,signUp:N,signOut:j,resetPassword:P,updatePassword:S,sendOTP:C,verifyOTP:I,isMasterAdmin:_,isOverallFocalPerson:k,isDimensionLeader:A,isDimensionMember:R,canManageAdmins:_||k,canAccessAllDimensions:_||k,canDeleteItems:_||k,assignedDimensionId:J},children:u})}let d=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9056:(e,s,t)=>{"use strict";t.d(s,{default:()=>p});var r=t(5155),a=t(2115),n=t(5695),l=t(1108),i=t(285),o=t(6695),d=t(2523),u=t(5057),c=t(3453),m=t(5339),f=t(8437);function p(e){let{user:s,admin:t}=e,p=(0,n.useRouter)(),{updatePassword:h}=(0,f.A)(),[g,w]=(0,a.useState)(""),[x,v]=(0,a.useState)(""),[b,y]=(0,a.useState)(null),[N,j]=(0,a.useState)(!1),P=e=>e.length<8?"Password must be at least 8 characters long":/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?null:"Password must contain at least one number":"Password must contain at least one lowercase letter":"Password must contain at least one uppercase letter",S=async e=>{e.preventDefault(),j(!0),y(null);let t=P(g);if(t){y(t),j(!1);return}if(g!==x){y("Passwords do not match"),j(!1);return}try{let{error:e}=await h(g);if(e)throw e;let{error:t}=await l.N.from("admins").update({status:"active"}).eq("id",s.id);if(t)throw t;p.replace("/dashboard")}catch(e){console.error("Password setup failed:",e),y(e.message||"Something went wrong while setting your password.")}finally{j(!1)}};return(0,r.jsx)("div",{className:"w-full max-w-md",children:(0,r.jsxs)(o.Zp,{children:[(0,r.jsxs)(o.aR,{className:"space-y-1",children:[(0,r.jsx)(o.ZB,{className:"text-2xl font-bold",children:"Set Up Your Password"}),(0,r.jsxs)(o.BT,{children:["Welcome! Please create a new password for your account:"," ",(0,r.jsx)("span",{className:"font-medium",children:s.email})]})]}),(0,r.jsx)(o.Wu,{children:(0,r.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(u.J,{htmlFor:"new-password",children:"New Password"}),(0,r.jsx)(d.p,{id:"new-password",type:"password",required:!0,value:g,onChange:e=>w(e.target.value),disabled:N})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(u.J,{htmlFor:"confirm-password",children:"Confirm Password"}),(0,r.jsx)(d.p,{id:"confirm-password",type:"password",required:!0,value:x,onChange:e=>v(e.target.value),disabled:N})]}),(0,r.jsxs)("div",{className:"rounded-lg border bg-muted/50 p-3 text-sm",children:[(0,r.jsx)("p",{className:"font-medium mb-2",children:"Password Requirements:"}),(0,r.jsxs)("ul",{className:"space-y-1 text-muted-foreground",children:[(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-3 w-3"})," At least 8 characters long"]}),(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-3 w-3"})," One uppercase letter"]}),(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-3 w-3"})," One lowercase letter"]}),(0,r.jsxs)("li",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-3 w-3"})," One number"]})]})]}),b&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[(0,r.jsx)(m.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:b})]}),(0,r.jsx)(i.$,{type:"submit",className:"w-full",disabled:N,children:N?"Setting up...":"Set Password"})]})})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[9688,1537,788,8441,1684,7358],()=>s(7723)),_N_E=e.O()}]);