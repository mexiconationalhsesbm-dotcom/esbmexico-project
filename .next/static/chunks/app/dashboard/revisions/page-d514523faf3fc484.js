(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8836],{285:(e,r,t)=>{"use strict";t.d(r,{$:()=>o,r:()=>d});var s=t(5155),n=t(2115),i=t(9708),a=t(2085),l=t(6707);let d=(0,a.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,r)=>{let{className:t,variant:n,size:a,asChild:o=!1,...c}=e,u=o?i.DX:"button";return(0,s.jsx)(u,{className:(0,l.cn)(d({variant:n,size:a,className:t})),ref:r,...c})});o.displayName="Button"},852:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(5155);t(2115);let n=e=>{let{children:r,size:t="md",variant:n="primary",startIcon:i,endIcon:a,onClick:l,className:d="",disabled:o=!1,type:c}=e;return(0,s.jsxs)("button",{type:c,className:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition ".concat(d," ").concat({sm:"px-4 py-3 text-sm",md:"px-5 py-3.5 text-sm"}[t]," ").concat({primary:"bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300",outline:"bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300"}[n]," ").concat(o?"cursor-not-allowed opacity-50":""),onClick:l,disabled:o,children:[i&&(0,s.jsx)("span",{className:"flex items-center",children:i}),r,a&&(0,s.jsx)("span",{className:"flex items-center",children:a})]})}},1108:(e,r,t)=>{"use strict";t.d(r,{N:()=>n});var s=t(1537);t(9509);let n=(0,s.UU)("https://kegskzgwkhltieyddbby.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlZ3Nremd3a2hsdGlleWRkYmJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTMyMzQsImV4cCI6MjA2Mzg2OTIzNH0.daWkoPRZZsqlhRINmeWDSe1cm6JwRP7rf_jy1npw-7Q")},2085:(e,r,t)=>{"use strict";t.d(r,{F:()=>a});var s=t(2596);let n=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,i=s.$,a=(e,r)=>t=>{var s;if((null==r?void 0:r.variants)==null)return i(e,null==t?void 0:t.class,null==t?void 0:t.className);let{variants:a,defaultVariants:l}=r,d=Object.keys(a).map(e=>{let r=null==t?void 0:t[e],s=null==l?void 0:l[e];if(null===r)return null;let i=n(r)||n(s);return a[e][i]}),o=t&&Object.entries(t).reduce((e,r)=>{let[t,s]=r;return void 0===s||(e[t]=s),e},{});return i(e,d,null==r||null==(s=r.compoundVariants)?void 0:s.reduce((e,r)=>{let{class:t,className:s,...n}=r;return Object.entries(n).every(e=>{let[r,t]=e;return Array.isArray(t)?t.includes({...l,...o}[r]):({...l,...o})[r]===t})?[...e,t,s]:e},[]),null==t?void 0:t.class,null==t?void 0:t.className)}},2596:(e,r,t)=>{"use strict";function s(){for(var e,r,t=0,s="",n=arguments.length;t<n;t++)(e=arguments[t])&&(r=function e(r){var t,s,n="";if("string"==typeof r||"number"==typeof r)n+=r;else if("object"==typeof r)if(Array.isArray(r)){var i=r.length;for(t=0;t<i;t++)r[t]&&(s=e(r[t]))&&(n&&(n+=" "),n+=s)}else for(s in r)r[s]&&(n&&(n+=" "),n+=s);return n}(e))&&(s&&(s+=" "),s+=r);return s}t.d(r,{$:()=>s})},3453:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},4186:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},4324:(e,r,t)=>{Promise.resolve().then(t.bind(t,8153))},4861:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},4990:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var s=t(5155);t(2115);let n=e=>{let{variant:r="light",color:t="primary",size:n="md",startIcon:i,endIcon:a,children:l,className:d="",...o}=e,c=["inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full font-medium transition-colors",{sm:"text-theme-xs",md:"text-sm"}[n],{light:{primary:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",success:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",error:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",warning:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300",info:"bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300",light:"bg-gray-100 text-gray-700 dark:bg-white/10 dark:text-gray-200",dark:"bg-gray-600 text-white dark:bg-gray-800"},solid:{primary:"bg-blue-600 text-white",success:"bg-green-600 text-white",error:"bg-red-600 text-white",warning:"bg-yellow-600 text-white",info:"bg-sky-600 text-white",light:"bg-gray-300 text-gray-800",dark:"bg-gray-900 text-white"}}[r][t],d].filter(Boolean).join(" ");return(0,s.jsxs)("span",{className:c,...o,children:[i&&(0,s.jsx)("span",{className:"mr-1",children:i}),l,a&&(0,s.jsx)("span",{className:"ml-1",children:a})]})}},5339:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6101:(e,r,t)=>{"use strict";t.d(r,{s:()=>a,t:()=>i});var s=t(2115);function n(e,r){if("function"==typeof e)return e(r);null!=e&&(e.current=r)}function i(...e){return r=>{let t=!1,s=e.map(e=>{let s=n(e,r);return t||"function"!=typeof s||(t=!0),s});if(t)return()=>{for(let r=0;r<s.length;r++){let t=s[r];"function"==typeof t?t():n(e[r],null)}}}}function a(...e){return s.useCallback(i(...e),e)}},6695:(e,r,t)=>{"use strict";t.d(r,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>a,aR:()=>l});var s=t(5155),n=t(2115),i=t(6707);let a=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});a.displayName="Card";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...n})});l.displayName="CardHeader";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});d.displayName="CardTitle";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",t),...n})});o.displayName="CardDescription";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",t),...n})});c.displayName="CardContent",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},6707:(e,r,t)=>{"use strict";t.d(r,{cn:()=>i});var s=t(2596),n=t(9688);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.QP)((0,s.$)(r))}},8153:(e,r,t)=>{"use strict";t.d(r,{default:()=>x});var s=t(5155),n=t(2115),i=t(5695),a=t(285),l=t(852),d=t(6695),o=t(5339),c=t(4186),u=t(3453),m=t(4861),f=t(1108),p=t(9344),g=t(4990),h=t(6766);function x(e){let{admin:r}=e,t=(0,i.useRouter)(),[x,v]=(0,n.useState)([]),[y,b]=(0,n.useState)([]),[j,N]=(0,n.useState)(!0),[w,k]=(0,n.useState)(null),[_,A]=(0,n.useState)("pending"),[R,C]=(0,n.useState)(null),q=(null==r?void 0:r.role_id)===4,I=(null==r?void 0:r.role_id)===2,E=r.assigned_dimension_id,S=(0,n.useCallback)(async()=>{N(!0),k(null);try{let e=f.N.from("revision_requests").select("*").order("created_at",{ascending:!1});!I&&E&&(e=e.eq("dimension_id",E));let{data:r,error:t}=await e;if(t)throw t;if(!r||0===r.length)return void v([]);let s=[...new Set(r.map(e=>e.requested_by).filter(Boolean))],{data:n,error:i}=await f.N.from("admins").select("\n          id,\n          email,\n          role_id,\n          teachers:teachers!inner (\n            id,\n            teacher_id,\n            fullname,\n            profile_url\n          )\n        ").in("id",s);if(i)throw i;let a=new Map(n.map(e=>[e.id,{email:e.email,role_id:e.role_id,teacher:e.teachers?e.teachers[0]:null}])),l=await Promise.all(r.map(async e=>{try{let r=null,t=null;if("folder"===e.item_type){let{data:s}=await f.N.from("folders").select("name, status").eq("id",e.item_id).single();r=null==s?void 0:s.name,t=null==s?void 0:s.status}else if("file"===e.item_type){let{data:s}=await f.N.from("files").select("name, status").eq("id",e.item_id).single();r=null==s?void 0:s.name,t=null==s?void 0:s.status}let s=a.get(e.requested_by),n=null==s?void 0:s.teacher;return{...e,item_name:r,item_status:t,requester_email:null==s?void 0:s.email,requester_name:null==n?void 0:n.fullname,requester_teacher_id:null==n?void 0:n.teacher_id,requester_profile:null==n?void 0:n.profile_url}}catch(r){return{...e,item_name:"(Item not found)"}}}));v(l)}catch(e){console.error("Error fetching revisions:",e),k(e.message||"Failed to load revision requests")}finally{N(!1)}},[I,E]);(0,n.useEffect)(()=>{q||I||(0,i.notFound)(),S()},[q,I,S]),(0,n.useEffect)(()=>{"all"===_?b(x):b(x.filter(e=>e.status===_))},[x,_]);let O=async e=>{C(e);try{if(!(await fetch("/api/folders/approve-revision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({revisionRequestId:e,approve:!0,reviewerNotes:"Approved"})})).ok)throw Error("Failed to approve revision");t.refresh(),S()}catch(e){console.error("Error approving revision:",e),alert(e.message||"Failed to approve revision")}finally{C(null)}},$=async e=>{C(e);try{if(!(await fetch("/api/folders/approve-revision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({revisionRequestId:e,approve:!1,reviewerNotes:"Rejected"})})).ok)throw Error("Failed to reject revision");t.refresh(),S()}catch(e){console.error("Error rejecting revision:",e),alert(e.message||"Failed to reject revision")}finally{C(null)}};return(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Revision Requests"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Review and manage revision requests from dimension members"})]}),w&&(0,s.jsxs)("div",{children:[(0,s.jsx)(o.A,{className:"h-4 w-4"}),(0,s.jsx)("div",{children:w})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(a.$,{variant:"pending"===_?"default":"outline",onClick:()=>A("pending"),className:"gap-2",children:[(0,s.jsx)(c.A,{className:"h-4 w-4"}),"Pending (",x.filter(e=>"pending"===e.status).length,")"]}),(0,s.jsxs)(a.$,{variant:"approved"===_?"default":"outline",onClick:()=>A("approved"),className:"gap-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),"Approved (",x.filter(e=>"approved"===e.status).length,")"]}),(0,s.jsxs)(a.$,{variant:"rejected"===_?"default":"outline",onClick:()=>A("rejected"),className:"gap-2",children:[(0,s.jsx)(m.A,{className:"h-4 w-4"}),"Rejected (",x.filter(e=>"rejected"===e.status).length,")"]}),(0,s.jsxs)(a.$,{variant:"all"===_?"default":"outline",onClick:()=>A("all"),children:["All (",x.length,")"]})]}),j?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading revision requests..."}):0===y.length?(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:["No ","all"!==_?_:""," revision requests found"]}):(0,s.jsx)("div",{className:"space-y-4",children:y.map(e=>(0,s.jsxs)(d.Zp,{children:[(0,s.jsx)(d.aR,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,s.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Requested By:"}),(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"w-15 h-15 flex items-center",children:(0,s.jsx)(h.default,{src:e.requester_profile||"/images/icons/admin_profile.svg",alt:"".concat(e.requester_name,"'s profile"),width:45,height:45,className:"w-[45px] h-[45px] rounded-full object-cover border border-gray-200 dark:border-gray-700",onError:e=>e.currentTarget.src="/images/icons/admin_profile.svg"})}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground bg-muted rounded",children:[e.requester_name,(0,s.jsx)("span",{className:"text-xs text-gray-500",children:" (".concat(e.requester_email,")")})]})]})]}),(0,s.jsxs)("div",{className:"mt-5",children:[(0,s.jsx)(d.ZB,{className:"text-xl",children:"".concat(e.item_type,": ").concat(e.item_name)}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Requested ",(0,p.m)(new Date(e.created_at),{addSuffix:!0})]})]})]}),(0,s.jsxs)(g.A,{variant:"light",color:"pending"===e.status?"warning":"approved"===e.status?"success":"error",children:["pending"===e.status&&"Pending","approved"===e.status&&"Approved","rejected"===e.status&&"Rejected"]})]})}),(0,s.jsxs)(d.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Reason for Revision:"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground bg-muted p-3 rounded",children:e.request_reason||"No reason provided"})]}),e.reviewer_notes&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Reviewer Notes:"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground bg-muted p-3 rounded",children:e.reviewer_notes})]}),"pending"===e.status&&(0,s.jsxs)("div",{className:"flex gap-2 pt-4 items-center",children:[(0,s.jsxs)(l.A,{onClick:()=>O(e.id),disabled:R===e.id,className:"gap-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),"Approve"]}),(0,s.jsxs)(a.$,{onClick:()=>$(e.id),disabled:R===e.id,variant:"destructive",className:"gap-2",children:[(0,s.jsx)(m.A,{className:"h-4 w-4"}),"Reject"]})]})]})]},e.id))})]})}},9708:(e,r,t)=>{"use strict";t.d(r,{DX:()=>l,Dc:()=>o,TL:()=>a});var s=t(2115),n=t(6101),i=t(5155);function a(e){let r=function(e){let r=s.forwardRef((e,r)=>{let{children:t,...i}=e;if(s.isValidElement(t)){var a;let e,l,d=(a=t,(l=(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.ref:(l=(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.props.ref:a.props.ref||a.ref),o=function(e,r){let t={...r};for(let s in r){let n=e[s],i=r[s];/^on[A-Z]/.test(s)?n&&i?t[s]=(...e)=>{let r=i(...e);return n(...e),r}:n&&(t[s]=n):"style"===s?t[s]={...n,...i}:"className"===s&&(t[s]=[n,i].filter(Boolean).join(" "))}return{...e,...t}}(i,t.props);return t.type!==s.Fragment&&(o.ref=r?(0,n.t)(r,d):d),s.cloneElement(t,o)}return s.Children.count(t)>1?s.Children.only(null):null});return r.displayName=`${e}.SlotClone`,r}(e),t=s.forwardRef((e,t)=>{let{children:n,...a}=e,l=s.Children.toArray(n),d=l.find(c);if(d){let e=d.props.children,n=l.map(r=>r!==d?r:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,i.jsx)(r,{...a,ref:t,children:s.isValidElement(e)?s.cloneElement(e,void 0,n):null})}return(0,i.jsx)(r,{...a,ref:t,children:n})});return t.displayName=`${e}.Slot`,t}var l=a("Slot"),d=Symbol("radix.slottable");function o(e){let r=({children:e})=>(0,i.jsx)(i.Fragment,{children:e});return r.displayName=`${e}.Slottable`,r.__radixId=d,r}function c(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===d}},9946:(e,r,t)=>{"use strict";t.d(r,{A:()=>u});var s=t(2115);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,t)=>t?t.toUpperCase():r.toLowerCase()),a=e=>{let r=i(e);return r.charAt(0).toUpperCase()+r.slice(1)},l=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()},d=e=>{for(let r in e)if(r.startsWith("aria-")||"role"===r||"title"===r)return!0};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,s.forwardRef)((e,r)=>{let{color:t="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:c="",children:u,iconNode:m,...f}=e;return(0,s.createElement)("svg",{ref:r,...o,width:n,height:n,stroke:t,strokeWidth:a?24*Number(i)/Number(n):i,className:l("lucide",c),...!u&&!d(f)&&{"aria-hidden":"true"},...f},[...m.map(e=>{let[r,t]=e;return(0,s.createElement)(r,t)}),...Array.isArray(u)?u:[u]])}),u=(e,r)=>{let t=(0,s.forwardRef)((t,i)=>{let{className:d,...o}=t;return(0,s.createElement)(c,{ref:i,iconNode:r,className:l("lucide-".concat(n(a(e))),"lucide-".concat(e),d),...o})});return t.displayName=a(e),t}}},e=>{var r=r=>e(e.s=r);e.O(0,[9688,1537,3063,6682,9344,8441,1684,7358],()=>r(4324)),_N_E=e.O()}]);