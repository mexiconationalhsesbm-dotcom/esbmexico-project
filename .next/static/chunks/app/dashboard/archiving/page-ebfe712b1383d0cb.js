(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1883],{3795:(e,a,t)=>{Promise.resolve().then(t.bind(t,6424))},4990:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});var s=t(5155);t(2115);let r=e=>{let{variant:a="light",color:t="primary",size:r="md",startIcon:l,endIcon:i,children:c,className:n="",...d}=e,o=["inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full font-medium transition-colors",{sm:"text-theme-xs",md:"text-sm"}[r],{light:{primary:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",success:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",error:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",warning:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300",info:"bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300",light:"bg-gray-100 text-gray-700 dark:bg-white/10 dark:text-gray-200",dark:"bg-gray-600 text-white dark:bg-gray-800"},solid:{primary:"bg-blue-600 text-white",success:"bg-green-600 text-white",error:"bg-red-600 text-white",warning:"bg-yellow-600 text-white",info:"bg-sky-600 text-white",light:"bg-gray-300 text-gray-800",dark:"bg-gray-900 text-white"}}[a][t],n].filter(Boolean).join(" ");return(0,s.jsxs)("span",{className:o,...d,children:[l&&(0,s.jsx)("span",{className:"mr-1",children:l}),c,i&&(0,s.jsx)("span",{className:"ml-1",children:i})]})}},6424:(e,a,t)=>{"use strict";t.d(a,{ArchivingPageClient:()=>y});var s=t(5155),r=t(2115),l=t(852),i=t(6695),c=t(4990),n=t(4165),d=t(1380),o=t(7434),h=t(1154),m=t(1788);let x=(0,t(9946).A)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);var u=t(3617),f=t(6958);function y(e){let{dimension:a,admin:t}=e,[y,p]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0),[j,b]=(0,r.useState)(null),[w,N]=(0,r.useState)(null),[k,A]=(0,r.useState)(!1),[_,C]=(0,r.useState)(null),[E,L]=(0,r.useState)(null),[S,T]=(0,r.useState)(null),{showAlert:I}=(0,f.M)(),O=(0,u.U)(),F=(0,r.useCallback)(async()=>{try{v(!0);let e=new URLSearchParams;a&&e.append("dimensionId",a);let t=await fetch("/api/archive/get-archiving-folders?".concat(e));if(!t.ok)throw Error("Failed to fetch folders");let s=await t.json();p(s.folders||[])}catch(e){console.error("Error fetching folders:",e)}finally{v(!1)}},[a]);(0,r.useEffect)(()=>{F()},[F]);let M=async(e,a,t,s,r,l)=>{try{await O.from("system_logs").insert([{account_id:e||null,action:t,entity_type:"archive",entity_name:r,entity_id:a,status:s,description:l}])}catch(e){console.error("System log insert error:",e)}},R=async e=>{try{b(e);let a=await fetch("/api/archive/get-folder-contents?folderId=".concat(e.id,"&dimensionId=").concat(e.dimension_id));if(!a.ok)throw Error("Failed to fetch folder contents");let t=await a.json();N(t.structure),A(!0)}catch(e){console.error("Error fetching folder contents:",e)}},U=async e=>{try{C(e.id);let a=await fetch("/api/archive/local-archive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:e.id,dimensionId:e.dimension_id})});if(!a.ok)throw Error("Failed to create local archive");await M(t,e.id,"LOCAL_ARCHIVE","success",e.name,"The user has successfully archived the folder '".concat(e.name,"' to local archive."));let s=await a.blob(),r=window.URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download="".concat(e.name,"_local_archive.zip"),document.body.appendChild(l),l.click(),document.body.removeChild(l),I({type:"success",title:"Local Archiving",message:"The user has successfully archived the folder '".concat(e.name,"' to local archive")}),await F()}catch(a){console.error("Error creating local archive:",a),await M(t,e.id,"LOCAL_ARCHIVE","success",e.name,"The user has failed to local archive the folder '".concat(e.name,"'.")),I({type:"error",title:"Local Archiving",message:"The user has failed to local archive the folder '".concat(e.name,"'")})}finally{C(null)}},z=async e=>{try{if(L(e.id),!(await fetch("/api/archive/cloud-archive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:e.id,dimensionId:e.dimension_id})})).ok)throw Error("Failed to archive to cloud");await M(t,e.id,"CLOUD_ARCHIVE","success",e.name,"The user has successfully archived the folder '".concat(e.name,"' to the cloud archive.")),I({type:"success",title:"Local Archiving",message:"The user has successfully archived the folder '".concat(e.name,"' to cloud archive")}),await F()}catch(a){console.error("Error archiving to cloud:",a),I({type:"error",title:"Local Archiving",message:"The user has failed to archive the folder '".concat(e.name,"' to the cloud archive.")}),await M(t,e.id,"CLOUD_ARCHIVE","success",e.name,"The user has failed to archive the folder '".concat(e.name,"' to the cloud archive."))}finally{L(null)}},P=async e=>{if(confirm("Mark this folder as archived? Files will be deleted from the system."))try{if(T(e.id),!(await fetch("/api/archive/mark-archived",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:e.id,dimensionId:e.dimension_id})})).ok)throw Error("Failed to mark as archived");I({type:"success",title:"Mark as Archived",message:"The user has marked the folder '".concat(e.name,"' as Archived.")}),await M(t,e.id,"ARCHIVING_COMPLETED","success",e.name,"The user has marked the folder '".concat(e.name,"' as Archived.")),await F()}catch(a){console.error("Error marking as archived:",a),I({type:"error",title:"Mark as Archived",message:"The user has failed to mark as archived the folder '".concat(e.name,"'.")})}finally{T(null)}},V=e=>{let a=e.local_archive,t=e.cloud_archive;return a||t?a&&!t?(0,s.jsx)(c.A,{children:"Cloud Archive Needed"}):!a&&t?(0,s.jsx)(c.A,{children:"Local Archive Needed"}):(0,s.jsx)(c.A,{children:"Fully Archived"}):(0,s.jsx)(c.A,{children:"Not Archived"})},D=function(e){var a;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e?(0,s.jsxs)("div",{style:{marginLeft:"".concat(20*t,"px")},className:"py-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["folder"===e.type?(0,s.jsx)(d.A,{className:"h-4 w-4 text-blue-500"}):(0,s.jsx)(o.A,{className:"h-4 w-4 text-gray-500"}),(0,s.jsxs)("span",{className:"text-sm",children:[e.name,e.size&&(0,s.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",(e.size/1024/1024).toFixed(2)," MB)"]})]})]}),null==(a=e.children)?void 0:a.map(e=>D(e,t+1))]},"".concat(e.type,"-").concat(e.id)):null};return g?(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)(h.A,{className:"h-8 w-8 animate-spin"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Archiving Management"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage folders marked for archiving"})]}),0===y.length?(0,s.jsx)(i.Zp,{children:(0,s.jsx)(i.Wu,{className:"pt-6",children:(0,s.jsx)("p",{className:"text-center text-muted-foreground",children:"No folders marked for archiving"})})}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Folder Name"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Dimension"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"View Contents"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Local Archive"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Cloud Archive"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Status"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:y.map(e=>{var a;return(0,s.jsxs)("tr",{className:"border-b hover:bg-muted/50",children:[(0,s.jsx)("td",{className:"py-3 px-4",children:e.name}),(0,s.jsx)("td",{className:"py-3 px-4",children:(null==(a=e.dimensions)?void 0:a.name)||"N/A"}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)(l.A,{variant:"outline",size:"sm",onClick:()=>R(e),children:"See Files"})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)(l.A,{size:"sm",onClick:()=>U(e),disabled:_===e.id||e.local_archive,children:[_===e.id?(0,s.jsx)(h.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2"}),e.local_archive?"Downloaded":"Download"]})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)(l.A,{size:"sm",onClick:()=>z(e),disabled:E===e.id||e.cloud_archive,children:[E===e.id?(0,s.jsx)(h.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,s.jsx)(x,{className:"h-4 w-4 mr-2"}),e.cloud_archive?"Uploaded":"Upload"]})}),(0,s.jsx)("td",{className:"py-3 px-4",children:V(e)}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)(l.A,{size:"sm",onClick:()=>P(e),disabled:S===e.id||!e.local_archive||!e.cloud_archive,children:[S===e.id?(0,s.jsx)(h.A,{className:"h-4 w-4 animate-spin mr-2"}):null,"Mark Archived"]})})]},e.id)})})]})}),(0,s.jsx)(n.lG,{open:k,onOpenChange:A,children:(0,s.jsxs)(n.Cf,{className:"max-w-2xl max-h-96 overflow-auto bg-white dark:bg-gray-950",children:[(0,s.jsxs)(n.c7,{children:[(0,s.jsxs)(n.L3,{children:["Folder Contents: ",null==j?void 0:j.name]}),(0,s.jsx)(n.rr,{children:"View all files and subfolders"})]}),(0,s.jsx)("div",{className:"p-4 bg-muted rounded-lg overflow-auto",children:D(w)})]})})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[9688,1537,4203,9535,5933,5452,2349,8441,1684,7358],()=>a(3795)),_N_E=e.O()}]);