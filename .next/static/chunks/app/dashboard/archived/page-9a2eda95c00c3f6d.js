(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6920],{2523:(e,s,t)=>{"use strict";t.d(s,{p:()=>i});var a=t(5155),r=t(2115),l=t(6707);let i=r.forwardRef((e,s)=>{let{className:t,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...i})});i.displayName="Input"},4241:(e,s,t)=>{"use strict";t.d(s,{ArchivedPageClient:()=>u});var a=t(5155),r=t(2115),l=t(852),i=t(6695),n=t(2523),c=t(4165),o=t(1380),d=t(7434),m=t(1154),h=t(1788),f=t(3617),x=t(6958);function u(e){let{admin:s}=e,[t,u]=(0,r.useState)([]),[p,v]=(0,r.useState)([]),[j,g]=(0,r.useState)(!0),[w,y]=(0,r.useState)(""),[b,N]=(0,r.useState)(null),[_,A]=(0,r.useState)(!1),[C,k]=(0,r.useState)(null),{showAlert:E}=(0,x.M)(),S=(0,f.U)();(0,r.useEffect)(()=>{""===w.trim()?v(t):v(t.filter(e=>e.folder_name.toLowerCase().includes(w.toLowerCase())))},[w,t]);let U=(0,r.useCallback)(async()=>{try{g(!0);let e=await fetch("/api/archive/get-archived-folders");if(!e.ok)throw Error("Failed to fetch archived folders");let s=(await e.json()).folders||[],t=Array.from(new Set(s.map(e=>e.dimension_id).filter(Boolean))),a=await L(t);s=s.map(e=>({...e,dimension_name:a[e.dimension_id]||"N/A"})),u(s)}catch(e){console.error("Error fetching archived folders:",e)}finally{g(!1)}},[]);(0,r.useEffect)(()=>{U()},[U]);let F=e=>{N(e),A(!0)},L=async e=>{if(0===e.length)return{};try{let s=await fetch("/api/dimensions/get-dimensions?ids=".concat(e.join(",")));if(!s.ok)throw Error("Failed to fetch dimension names");let t=await s.json();return Object.fromEntries(t.dimensions.map(e=>[e.id,e.name]))}catch(e){return console.error("Error fetching dimension names:",e),{}}},R=async e=>{try{k(e.id);let t=e.storage_url.split("esbmexico-archive/")[1],a=await fetch("/api/archive/get-archive-download-url?file=".concat(encodeURIComponent(t)));if(!a.ok)throw Error("Download failed");await O(s,e.id,"success",e.folder_name,"User accessed ".concat(e.folder_name," from the cloud archive."));let r=await a.blob(),l=window.URL.createObjectURL(r),i=document.createElement("a");i.href=l,i.download="".concat(e.folder_name,"_archive.zip"),i.click(),window.URL.revokeObjectURL(l),E({type:"success",title:"Access Archived Folder",message:"User accessed ".concat(e.folder_name," from the cloud archive.")})}catch(t){console.error("Error downloading archive:",t),E({type:"error",title:"Access Archived Folder",message:"User failed to access ".concat(e.folder_name," from the cloud archive.")}),await O(s,e.id,"failed",e.folder_name,"User failed to access ".concat(e.folder_name," from the cloud archive."))}finally{k(null)}},O=async(e,s,t,a,r)=>{try{await S.from("system_logs").insert([{account_id:e||null,action:"ARCHIVE_ACCESS",entity_type:"archive",entity_name:a,entity_id:s,status:t,description:r}])}catch(e){console.error("System log insert error:",e)}},z=function(e){var s;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e?(0,a.jsxs)("div",{style:{marginLeft:"".concat(20*t,"px")},className:"py-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["folder"===e.type?(0,a.jsx)(o.A,{className:"h-4 w-4 text-blue-500"}):(0,a.jsx)(d.A,{className:"h-4 w-4 text-gray-500"}),(0,a.jsxs)("span",{className:"text-sm",children:[e.name,e.size&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",(e.size/1024/1024).toFixed(2)," MB)"]})]})]}),null==(s=e.children)?void 0:s.map(e=>z(e,t+1))]},"".concat(e.type,"-").concat(e.id)):null};return j?(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsx)(m.A,{className:"h-8 w-8 animate-spin"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Archived Folders"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Access and manage archived folders"})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(n.p,{placeholder:"Search archived folders...",value:w,onChange:e=>y(e.target.value),className:"max-w-sm"})}),0===p.length?(0,a.jsx)(i.Zp,{children:(0,a.jsx)(i.Wu,{className:"pt-6",children:(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:0===t.length?"No archived folders":"No folders match your search"})})}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Folder Name"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Dimension"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"View Contents"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Archived Date"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:p.map(e=>(0,a.jsxs)("tr",{className:"border-b hover:bg-muted/50",children:[(0,a.jsx)("td",{className:"py-3 px-4",children:e.folder_name}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.dimension_name||"N/A"}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)(l.A,{variant:"outline",size:"sm",onClick:()=>F(e),children:"See Files"})}),(0,a.jsx)("td",{className:"py-3 px-4 text-sm",children:new Date(e.archived_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)(l.A,{size:"sm",onClick:()=>R(e),disabled:C===e.id,children:[C===e.id?(0,a.jsx)(m.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Access"]})})]},e.id))})]})}),(0,a.jsx)(c.lG,{open:_,onOpenChange:A,children:(0,a.jsxs)(c.Cf,{className:"max-w-2xl max-h-96 overflow-auto bg-white dark:bg-gray-950",children:[(0,a.jsxs)(c.c7,{children:[(0,a.jsxs)(c.L3,{children:["Folder Contents: ",null==b?void 0:b.folder_name]}),(0,a.jsx)(c.rr,{children:"View all files and subfolders that were archived"})]}),(0,a.jsx)("div",{className:"p-4 bg-muted rounded-lg overflow-auto",children:z(null==b?void 0:b.original_folder_structure)})]})})]})}},8253:(e,s,t)=>{Promise.resolve().then(t.bind(t,4241))}},e=>{var s=s=>e(e.s=s);e.O(0,[9688,1537,4203,9535,5933,5452,2349,8441,1684,7358],()=>s(8253)),_N_E=e.O()}]);