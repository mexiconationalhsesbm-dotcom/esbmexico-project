(()=>{var e={};e.id=5181,e.ids=[5181],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},26350:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>f,serverHooks:()=>c,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>p});var o=t(96559),i=t(48088),n=t(37719),a=t(32190);let d=(0,t(23607).UU)("https://kegskzgwkhltieyddbby.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}});async function l(e){let{data:r,error:t}=await d.from("folders").select("id").eq("parent_folder_id",e);if(t)return console.error("Error fetching child folders:",t),[];if(!r||0===r.length)return[];let s=r.map(e=>e.id),o=s.map(e=>l(e)),i=await Promise.all(o),n=[...s];for(let e of i)n.push(...e);return n}async function p(e){try{let{id:r}=await e.json();if(!r)return a.NextResponse.json({error:"Missing folder ID"},{status:400});let{data:t,error:s}=await d.from("folders").select("*").eq("id",r).single();if(s||!t)return a.NextResponse.json({error:"Folder not found"},{status:404});let{error:o}=await d.from("trash").insert({item_id:t.id,item_type:"folder",item_name:t.name,dimension_id:t.dimension_id,original_parent_id:t.parent_folder_id,root_deleted_folder_id:t.id});if(o)return console.error("Error moving folder to trash:",o),a.NextResponse.json({error:o.message},{status:500});let i=[r,...await l(r)],{data:n,error:p}=await d.from("files").select("id, file_path, name, file_size, file_type, public_url, folder_id").in("folder_id",i);if(p)return console.error("Error fetching files:",p),a.NextResponse.json({error:p.message},{status:500});if(n&&n.length>0){let e=n.map(e=>({item_id:e.id,item_type:"file",item_name:e.name,dimension_id:t.dimension_id,file_path:e.file_path,file_size:e.file_size,file_type:e.file_type,public_url:e.public_url,original_folder_id:e.folder_id,root_deleted_folder_id:r})),{error:s}=await d.from("trash").insert(e);if(s)return console.error("Error storing file metadata in trash:",s),a.NextResponse.json({error:s.message},{status:500});let{error:o}=await d.from("files").delete().in("id",n.map(e=>e.id));if(o)return console.error("Error deleting files from database:",o),a.NextResponse.json({error:o.message},{status:500})}let f=await Promise.all(i.slice(1).map(async e=>{let{data:s}=await d.from("folders").select("*").eq("id",e).single();return{item_id:e,item_type:"folder",item_name:s?.name||"Unknown",dimension_id:t.dimension_id,original_parent_id:s?.parent_folder_id||r,root_deleted_folder_id:r}}));if(f.length>0){let{error:e}=await d.from("trash").insert(f);if(e)return console.error("Error storing nested folder metadata in trash:",e),a.NextResponse.json({error:e.message},{status:500})}for(let e=i.length-1;e>=0;e--){let{error:r}=await d.from("folders").delete().eq("id",i[e]);if(r)return console.error(`Error deleting folder ${i[e]}:`,r),a.NextResponse.json({error:r.message},{status:500})}return a.NextResponse.json({success:!0})}catch(e){return console.error("Unexpected error:",e),a.NextResponse.json({error:e.message||"An unexpected error occurred"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/folders/delete/route",pathname:"/api/folders/delete",filename:"route",bundlePath:"app/api/folders/delete/route"},resolvedPagePath:"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\api\\folders\\delete\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:u,workUnitAsyncStorage:m,serverHooks:c}=f;function _(){return(0,n.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:m})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,3607,580],()=>t(26350));module.exports=s})();