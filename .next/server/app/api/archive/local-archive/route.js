(()=>{var e={};e.id=9601,e.ids=[9601],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},38082:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>x,routeModule:()=>m,serverHooks:()=>v,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var a={};t.r(a),t.d(a,{POST:()=>p});var s=t(96559),i=t(48088),o=t(37719),n=t(32190),l=t(76033),c=t(83398),d=t.n(c);let u=(0,t(23607).UU)("https://kegskzgwkhltieyddbby.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}});async function p(e){try{let r=await (0,l.U)(),{data:{user:t}}=await r.auth.getUser();if(!t)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{folderId:a,dimensionId:s}=await e.json();if(!a||!s)return n.NextResponse.json({error:"Folder ID and Dimension ID required"},{status:400});let{data:i,error:o}=await u.from("folders").select("id, name, dimension_id").eq("id",a).single();if(o||!i||i.dimension_id!==Number(s))return n.NextResponse.json({error:"Folder not found"},{status:404});let c=new(d());await f(c,a,s,"");let p=await c.generateAsync({type:"nodebuffer"});await u.from("folders").update({local_archive:!0,updated_at:new Date().toISOString()}).eq("id",a);let m=new Uint8Array(p);return new n.NextResponse(new Blob([m]),{headers:{"Content-Type":"application/zip","Content-Disposition":`attachment; filename="${i.name}_local_archive.zip"`}})}catch(e){return console.error("Error in local archive:",e),n.NextResponse.json({error:e.message||"Failed to create local archive"},{status:500})}}async function f(e,r,t,a){let{data:s,error:i}=await u.from("files").select("id, name, file_path").eq("folder_id",r).eq("dimension_id",t);for(let r of(i&&console.error("Error fetching files:",i),s||[]))try{let{data:t,error:s}=await u.storage.from("files").download(r.file_path);if(!s&&t){let s=await t.arrayBuffer(),i=Buffer.from(s),o=a?`${a}/${r.name}`:r.name;e.file(o,i)}}catch(e){console.error(`Error processing file "${r.name}":`,e)}let{data:o,error:n}=await u.from("folders").select("id, name").eq("parent_folder_id",r).eq("dimension_id",t);for(let r of(n&&console.error("Error fetching subfolders:",n),o||[])){let s=a?`${a}/${r.name}`:r.name;await f(e,r.id,t,s)}}let m=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/archive/local-archive/route",pathname:"/api/archive/local-archive",filename:"route",bundlePath:"app/api/archive/local-archive/route"},resolvedPagePath:"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\api\\archive\\local-archive\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:v}=m;function x(){return(0,o.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76033:(e,r,t)=>{"use strict";t.d(r,{U:()=>i});var a=t(34386),s=t(44999);async function i(){let e=await (0,s.UL)();return(0,a.createServerClient)("https://kegskzgwkhltieyddbby.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlZ3Nremd3a2hsdGlleWRkYmJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTMyMzQsImV4cCI6MjA2Mzg2OTIzNH0.daWkoPRZZsqlhRINmeWDSe1cm6JwRP7rf_jy1npw-7Q",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:a})=>e.set(r,t,a))}catch{}}}})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[7719,3607,580,4999,4386,3398],()=>t(38082));module.exports=a})();