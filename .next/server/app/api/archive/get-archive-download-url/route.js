(()=>{var e={};e.id=4541,e.ids=[4541],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76765:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>p,serverHooks:()=>l,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>d});var o={};t.r(o),t.d(o,{GET:()=>u});var a=t(96559),s=t(48088),n=t(37719),i=t(32190);async function u(e){try{let r=new URL(e.url).searchParams.get("file");if(!r)return i.NextResponse.json({error:"Missing file name"},{status:400});let t=await fetch("https://api.backblazeb2.com/b2api/v2/b2_authorize_account",{headers:{Authorization:"Basic "+Buffer.from(`${process.env.B2_APPLICATION_KEY_ID}:${process.env.B2_APPLICATION_KEY}`).toString("base64")}}),o=await t.json();if(!t.ok)return console.error("Auth Error:",o),i.NextResponse.json({error:"Failed to authorize Backblaze"},{status:400});let a=await fetch(`${o.apiUrl}/b2api/v2/b2_get_download_authorization`,{method:"POST",headers:{Authorization:o.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify({bucketId:process.env.B2_BUCKET_ID,fileNamePrefix:r,validDurationInSeconds:300})}),s=await a.json();if(!a.ok)return console.error("Download Auth Error:",s),i.NextResponse.json({error:"Failed to get download authorization"},{status:400});let n=`${o.downloadUrl}/file/${process.env.B2_BUCKET_NAME}/${r}?Authorization=${s.authorizationToken}`,u=await fetch(n),p=await u.arrayBuffer();return new i.NextResponse(Buffer.from(p),{headers:{"Content-Type":u.headers.get("Content-Type")||"application/octet-stream","Content-Disposition":`attachment; filename="${r.split("/").pop()}"`}})}catch(e){return console.error("Error generating signed URL:",e),i.NextResponse.json({error:e.message},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/archive/get-archive-download-url/route",pathname:"/api/archive/get-archive-download-url",filename:"route",bundlePath:"app/api/archive/get-archive-download-url/route"},resolvedPagePath:"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\api\\archive\\get-archive-download-url\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:c,workUnitAsyncStorage:d,serverHooks:l}=p;function h(){return(0,n.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:d})}},78335:()=>{},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[7719,580],()=>t(76765));module.exports=o})();