(()=>{var e={};e.id=7057,e.ids=[7057],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4195:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>m,routeModule:()=>_,serverHooks:()=>f,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>c});var i={};t.r(i),t.d(i,{POST:()=>u});var o=t(96559),s=t(48088),a=t(37719),n=t(32190);let d=(0,t(23607).UU)("https://kegskzgwkhltieyddbby.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{persistSession:!1}});async function l(e,r){let{error:t}=await d.from(e).insert(r);if(t){let i=(t.message||"").toLowerCase();if(i.includes("duplicate")||i.includes("already exists")||i.includes("unique"))return console.warn(`safeInsert: ${e} row already exists (id=${r.id||"unknown"}) - skipping`),{error:null}}return{error:t}}async function u(e){try{let{trashId:r,itemType:t}=await e.json();if(!r||!t)return n.NextResponse.json({error:"Missing trash ID or item type"},{status:400});let{data:i,error:o}=await d.from("trash").select("*").eq("id",r).single();if(o||!i)return console.error("[recover] Trash item not found:",o),n.NextResponse.json({error:"Trash item not found"},{status:404});if("file"===t){let e={id:i.item_id,name:i.item_name,dimension_id:i.dimension_id,folder_id:i.original_folder_id,file_path:i.file_path,file_size:i.file_size,file_type:i.file_type,public_url:i.public_url,uploaded_by:i.uploaded_by??"Current User",created_at:i.created_at,updated_at:new Date().toISOString()},{error:t}=await l("files",e);if(t)return console.error("[recover] Error restoring file:",t),n.NextResponse.json({error:t.message},{status:500});let{error:o}=await d.from("trash").delete().eq("id",r);if(o)return console.error("[recover] Error deleting file from trash:",o),n.NextResponse.json({error:o.message},{status:500})}else if("folder"===t){let e={id:i.item_id,name:i.item_name,dimension_id:i.dimension_id,parent_folder_id:i.original_parent_id,created_at:i.created_at,updated_at:new Date().toISOString()},{error:r}=await l("folders",e);if(r)return console.error("[recover] Error restoring root folder:",r),n.NextResponse.json({error:r.message},{status:500});let{data:t,error:o}=await d.from("trash").select("*").eq("root_deleted_folder_id",i.item_id);if(o)return console.error("[recover] Error fetching related trash items:",o),n.NextResponse.json({error:o.message},{status:500});let s=(t||[]).filter(e=>"folder"===e.item_type&&e.item_id!==i.item_id),a=(t||[]).filter(e=>"file"===e.item_type),u=new Set([i.item_id]),_=new Map(s.map(e=>[e.item_id,e])),p=!0;for(;_.size>0&&p;){for(let[e,r]of(p=!1,Array.from(_.entries()))){let t=r.original_parent_id;if(null==t||u.has(t)){let t={id:r.item_id,name:r.item_name,dimension_id:r.dimension_id,parent_folder_id:r.original_parent_id,created_at:r.created_at,updated_at:new Date().toISOString()},{error:i}=await l("folders",t);if(i)return console.error(`[recover] Error restoring folder id=${e}:`,i),n.NextResponse.json({error:i.message},{status:500});u.add(e),_.delete(e),p=!0}}if(!p&&_.size>0){for(let[e,r]of(console.warn("[recover] Orphaned subfolders detected, assigning root as parent."),Array.from(_.entries()))){let t={id:r.item_id,name:r.item_name,dimension_id:r.dimension_id,parent_folder_id:i.item_id,created_at:r.created_at,updated_at:new Date().toISOString()},{error:o}=await l("folders",t);if(o)return console.error(`[recover] Error restoring orphan folder id=${e}:`,o),n.NextResponse.json({error:o.message},{status:500});u.add(e),_.delete(e)}break}}for(let e of a){let r=u.has(e.original_folder_id)&&e.original_folder_id?e.original_folder_id:i.item_id,t={id:e.item_id,name:e.item_name,dimension_id:e.dimension_id,folder_id:r,file_path:e.file_path,file_size:e.file_size,file_type:e.file_type,public_url:e.public_url,uploaded_by:e.uploaded_by??"Current User",created_at:e.created_at,updated_at:new Date().toISOString()},{error:o}=await l("files",t);if(o)return console.error(`[recover] Error restoring file id=${e.item_id}:`,o),n.NextResponse.json({error:o.message},{status:500})}let{error:c}=await d.from("trash").delete().eq("root_deleted_folder_id",i.item_id);if(c)return console.error("[recover] Error cleaning up trash:",c),n.NextResponse.json({error:c.message},{status:500})}return n.NextResponse.json({success:!0})}catch(e){return console.error("[recover] Unexpected error:",e),n.NextResponse.json({error:e.message||"An unexpected error occurred"},{status:500})}}let _=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/trash/recover/route",pathname:"/api/trash/recover",filename:"route",bundlePath:"app/api/trash/recover/route"},resolvedPagePath:"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\api\\trash\\recover\\route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:p,workUnitAsyncStorage:c,serverHooks:f}=_;function m(){return(0,a.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:c})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[7719,3607,580],()=>t(4195));module.exports=i})();