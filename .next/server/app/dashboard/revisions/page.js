(()=>{var e={};e.id=8836,e.ids=[8836],e.modules={3116:(e,r,s)=>{Promise.resolve().then(s.bind(s,99146))},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13388:(e,r,s)=>{Promise.resolve().then(s.bind(s,52291))},14270:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var t=s(60687);s(43210);let a=({variant:e="light",color:r="primary",size:s="md",startIcon:a,endIcon:i,children:n,className:d="",...l})=>{let o=["inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full font-medium transition-colors",{sm:"text-theme-xs",md:"text-sm"}[s],{light:{primary:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",success:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",error:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",warning:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300",info:"bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300",light:"bg-gray-100 text-gray-700 dark:bg-white/10 dark:text-gray-200",dark:"bg-gray-600 text-white dark:bg-gray-800"},solid:{primary:"bg-blue-600 text-white",success:"bg-green-600 text-white",error:"bg-red-600 text-white",warning:"bg-yellow-600 text-white",info:"bg-sky-600 text-white",light:"bg-gray-300 text-gray-800",dark:"bg-gray-900 text-white"}}[e][r],d].filter(Boolean).join(" ");return(0,t.jsxs)("span",{className:o,...l,children:[a&&(0,t.jsx)("span",{className:"mr-1",children:a}),n,i&&(0,t.jsx)("span",{className:"ml-1",children:i})]})}},14719:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(62688).A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},35070:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>o,metadata:()=>l});var t=s(37413),a=s(67851),i=s(76033),n=s(39916),d=s(52291);let l={title:"eSBMexico Revision Requests | MNHS",description:"Mexico National High School e-SBM System"};async function o(){let e=await (0,i.U)(),{data:{user:r}}=await e.auth.getUser();r||(0,n.notFound)();let{data:s,error:l}=await e.from("admins").select("*").eq("id",r.id).single();return s&&4===s.role_id||(0,n.notFound)(),(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"space-y-6 mt-8",children:(0,t.jsx)(a.A,{title:"Revision Requests",children:(0,t.jsx)(d.default,{admin:s})})})})}},35071:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(62688).A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},52291:(e,r,s)=>{"use strict";s.d(r,{default:()=>t});let t=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\Jave\\\\Desktop\\\\research\\\\esbmexico\\\\src\\\\components\\\\dashboard\\\\RevisionsTable.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\components\\dashboard\\RevisionsTable.tsx","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67851:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var t=s(37413);s(61120);let a=({title:e,children:r,className:s="",desc:a=""})=>(0,t.jsxs)("div",{className:`rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] ${s}`,children:[(0,t.jsxs)("div",{className:"px-6 py-5",children:[(0,t.jsx)("h3",{className:"text-base font-medium text-gray-800 dark:text-white/90",children:e}),a&&(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:a})]}),(0,t.jsx)("div",{className:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6",children:(0,t.jsx)("div",{className:"space-y-6",children:r})})]})},68294:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>o});var t=s(65239),a=s(48088),i=s(88170),n=s.n(i),d=s(30893),l={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);s.d(r,l);let o={children:["",{children:["dashboard",{children:["revisions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,35070)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\revisions\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,63144)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,94431)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,54413)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\revisions\\page.tsx"],m={require:s,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/revisions/page",pathname:"/dashboard/revisions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},99146:(e,r,s)=>{"use strict";s.d(r,{default:()=>v});var t=s(60687),a=s(43210),i=s(16189),n=s(29523),d=s(94676),l=s(44493),o=s(93613),c=s(48730),m=s(14719),u=s(35071),p=s(33926),x=s(78201),h=s(14270),g=s(30474);function v({admin:e}){let r=(0,i.useRouter)(),[s,v]=(0,a.useState)([]),[f,b]=(0,a.useState)([]),[y,j]=(0,a.useState)(!0),[w,N]=(0,a.useState)(null),[_,k]=(0,a.useState)("pending"),[q,A]=(0,a.useState)(null);e?.role_id;let R=e?.role_id===2,P=e.assigned_dimension_id,C=(0,a.useCallback)(async()=>{j(!0),N(null);try{let e=p.N.from("revision_requests").select("*").order("created_at",{ascending:!1});!R&&P&&(e=e.eq("dimension_id",P));let{data:r,error:s}=await e;if(s)throw s;if(!r||0===r.length)return void v([]);let t=[...new Set(r.map(e=>e.requested_by).filter(Boolean))],{data:a,error:i}=await p.N.from("admins").select(`
          id,
          email,
          role_id,
          teachers:teachers!inner (
            id,
            teacher_id,
            fullname,
            profile_url
          )
        `).in("id",t);if(i)throw i;let n=new Map(a.map(e=>[e.id,{email:e.email,role_id:e.role_id,teacher:e.teachers?e.teachers[0]:null}])),d=await Promise.all(r.map(async e=>{try{let r=null,s=null;if("folder"===e.item_type){let{data:t}=await p.N.from("folders").select("name, status").eq("id",e.item_id).single();r=t?.name,s=t?.status}else if("file"===e.item_type){let{data:t}=await p.N.from("files").select("name, status").eq("id",e.item_id).single();r=t?.name,s=t?.status}let t=n.get(e.requested_by),a=t?.teacher;return{...e,item_name:r,item_status:s,requester_email:t?.email,requester_name:a?.fullname,requester_teacher_id:a?.teacher_id,requester_profile:a?.profile_url}}catch{return{...e,item_name:"(Item not found)"}}}));v(d)}catch(e){console.error("Error fetching revisions:",e),N(e.message||"Failed to load revision requests")}finally{j(!1)}},[R,P]),S=async e=>{A(e);try{if(!(await fetch("/api/folders/approve-revision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({revisionRequestId:e,approve:!0,reviewerNotes:"Approved"})})).ok)throw Error("Failed to approve revision");r.refresh(),C()}catch(e){console.error("Error approving revision:",e),alert(e.message||"Failed to approve revision")}finally{A(null)}},E=async e=>{A(e);try{if(!(await fetch("/api/folders/approve-revision",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({revisionRequestId:e,approve:!1,reviewerNotes:"Rejected"})})).ok)throw Error("Failed to reject revision");r.refresh(),C()}catch(e){console.error("Error rejecting revision:",e),alert(e.message||"Failed to reject revision")}finally{A(null)}};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Revision Requests"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Review and manage revision requests from dimension members"})]}),w&&(0,t.jsxs)("div",{children:[(0,t.jsx)(o.A,{className:"h-4 w-4"}),(0,t.jsx)("div",{children:w})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(n.$,{variant:"pending"===_?"default":"outline",onClick:()=>k("pending"),className:"gap-2",children:[(0,t.jsx)(c.A,{className:"h-4 w-4"}),"Pending (",s.filter(e=>"pending"===e.status).length,")"]}),(0,t.jsxs)(n.$,{variant:"approved"===_?"default":"outline",onClick:()=>k("approved"),className:"gap-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),"Approved (",s.filter(e=>"approved"===e.status).length,")"]}),(0,t.jsxs)(n.$,{variant:"rejected"===_?"default":"outline",onClick:()=>k("rejected"),className:"gap-2",children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),"Rejected (",s.filter(e=>"rejected"===e.status).length,")"]}),(0,t.jsxs)(n.$,{variant:"all"===_?"default":"outline",onClick:()=>k("all"),children:["All (",s.length,")"]})]}),y?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading revision requests..."}):0===f.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:["No ","all"!==_?_:""," revision requests found"]}):(0,t.jsx)("div",{className:"space-y-4",children:f.map(e=>(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,t.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Requested By:"}),(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsx)("div",{className:"w-15 h-15 flex items-center",children:(0,t.jsx)(g.default,{src:e.requester_profile||"/images/icons/admin_profile.svg",alt:`${e.requester_name}'s profile`,width:45,height:45,className:"w-[45px] h-[45px] rounded-full object-cover border border-gray-200 dark:border-gray-700",onError:e=>e.currentTarget.src="/images/icons/admin_profile.svg"})}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground bg-muted rounded",children:[e.requester_name,(0,t.jsx)("span",{className:"text-xs text-gray-500",children:` (${e.requester_email})`})]})]})]}),(0,t.jsxs)("div",{className:"mt-5",children:[(0,t.jsx)(l.ZB,{className:"text-xl",children:`${e.item_type}: ${e.item_name}`}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Requested ",(0,x.m)(new Date(e.created_at),{addSuffix:!0})]})]})]}),(0,t.jsxs)(h.A,{variant:"light",color:"pending"===e.status?"warning":"approved"===e.status?"success":"error",children:["pending"===e.status&&"Pending","approved"===e.status&&"Approved","rejected"===e.status&&"Rejected"]})]})}),(0,t.jsxs)(l.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Reason for Revision:"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground bg-muted p-3 rounded",children:e.request_reason||"No reason provided"})]}),e.reviewer_notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-sm mb-2",children:"Reviewer Notes:"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground bg-muted p-3 rounded",children:e.reviewer_notes})]}),"pending"===e.status&&(0,t.jsxs)("div",{className:"flex gap-2 pt-4 items-center",children:[(0,t.jsxs)(d.A,{onClick:()=>S(e.id),disabled:q===e.id,className:"gap-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4"}),"Approve"]}),(0,t.jsxs)(n.$,{onClick:()=>E(e.id),disabled:q===e.id,variant:"destructive",className:"gap-2",children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),"Reject"]})]})]})]},e.id))})]})}}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[7719,3607,4999,4386,1234,1931,5902,8201,8180,8557,1980],()=>s(68294));module.exports=t})();