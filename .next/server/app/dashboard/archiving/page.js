(()=>{var e={};e.id=1883,e.ids=[1883],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9177:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>n,metadata:()=>d});var s=t(37413),r=t(37478),i=t(76033),l=t(39916);let d={title:"Archived Folders",description:"Access and manage archived folders"};async function n(){let e=await (0,i.U)(),{data:{user:a}}=await e.auth.getUser();a||(0,l.notFound)();let{data:t,error:d}=await e.from("admins").select("role_id").eq("id",a.id).single();return t&&[2,3].includes(t.role_id)||(0,l.notFound)(),(0,s.jsx)("div",{className:"p-8",children:(0,s.jsx)(r.ArchivingPageClient,{admin:a.id})})}},10022:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(62688).A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11397:(e,a,t)=>{Promise.resolve().then(t.bind(t,37478))},14270:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});var s=t(60687);t(43210);let r=({variant:e="light",color:a="primary",size:t="md",startIcon:r,endIcon:i,children:l,className:d="",...n})=>{let o=["inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full font-medium transition-colors",{sm:"text-theme-xs",md:"text-sm"}[t],{light:{primary:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",success:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",error:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",warning:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300",info:"bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300",light:"bg-gray-100 text-gray-700 dark:bg-white/10 dark:text-gray-200",dark:"bg-gray-600 text-white dark:bg-gray-800"},solid:{primary:"bg-blue-600 text-white",success:"bg-green-600 text-white",error:"bg-red-600 text-white",warning:"bg-yellow-600 text-white",info:"bg-sky-600 text-white",light:"bg-gray-300 text-gray-800",dark:"bg-gray-900 text-white"}}[e][a],d].filter(Boolean).join(" ");return(0,s.jsxs)("span",{className:o,...n,children:[r&&(0,s.jsx)("span",{className:"mr-1",children:r}),l,i&&(0,s.jsx)("span",{className:"ml-1",children:i})]})}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},24549:(e,a,t)=>{Promise.resolve().then(t.bind(t,96516))},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},37478:(e,a,t)=>{"use strict";t.d(a,{ArchivingPageClient:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call ArchivingPageClient() from the server but ArchivingPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\components\\dashboard\\ArchivingPageClient.tsx","ArchivingPageClient")},41862:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(62688).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},42836:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>l.a,__next_app__:()=>h,pages:()=>c,routeModule:()=>m,tree:()=>o});var s=t(65239),r=t(48088),i=t(88170),l=t.n(i),d=t(30893),n={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);t.d(a,n);let o={children:["",{children:["dashboard",{children:["archiving",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,9177)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\archiving\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,63144)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,94431)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,54413)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\archiving\\page.tsx"],h={require:t,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/dashboard/archiving/page",pathname:"/dashboard/archiving",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63503:(e,a,t)=>{"use strict";t.d(a,{Cf:()=>h,Es:()=>p,L3:()=>u,c7:()=>m,lG:()=>n,rr:()=>x});var s=t(60687),r=t(43210),i=t(26134),l=t(11860),d=t(76279);let n=i.bL;i.l9;let o=i.ZL;i.bm;let c=r.forwardRef(({className:e,...a},t)=>(0,s.jsx)(i.hJ,{ref:t,className:(0,d.cn)("fixed inset-0 z-9999999 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));c.displayName=i.hJ.displayName;let h=r.forwardRef(({className:e,children:a,...t},r)=>(0,s.jsxs)(o,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)(i.UC,{ref:r,className:(0,d.cn)("fixed left-[50%] top-[50%] z-9999999 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[a,(0,s.jsxs)(i.bm,{className:"text-black dark:text-white absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(l.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));h.displayName=i.UC.displayName;let m=({className:e,...a})=>(0,s.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});m.displayName="DialogHeader";let p=({className:e,...a})=>(0,s.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});p.displayName="DialogFooter";let u=r.forwardRef(({className:e,...a},t)=>(0,s.jsx)(i.hE,{ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",e),...a}));u.displayName=i.hE.displayName;let x=r.forwardRef(({className:e,...a},t)=>(0,s.jsx)(i.VY,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",e),...a}));x.displayName=i.VY.displayName},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},82570:(e,a,t)=>{"use strict";t.d(a,{A:()=>s});let s=(0,t(62688).A)("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]])},96516:(e,a,t)=>{"use strict";t.d(a,{ArchivingPageClient:()=>f});var s=t(60687),r=t(43210),i=t(94676),l=t(44493),d=t(14270),n=t(63503),o=t(82570),c=t(10022),h=t(41862),m=t(31158);let p=(0,t(62688).A)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);var u=t(76431),x=t(13116);function f({dimension:e,admin:a}){let[t,f]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0),[y,b]=(0,r.useState)(null),[j,w]=(0,r.useState)(null),[k,N]=(0,r.useState)(!1),[A,C]=(0,r.useState)(null),[_,P]=(0,r.useState)(null),[E,L]=(0,r.useState)(null),{showAlert:M}=(0,x.M)(),T=(0,u.U)(),S=(0,r.useCallback)(async()=>{try{v(!0);let a=new URLSearchParams;e&&a.append("dimensionId",e);let t=await fetch(`/api/archive/get-archiving-folders?${a}`);if(!t.ok)throw Error("Failed to fetch folders");let s=await t.json();f(s.folders||[])}catch(e){console.error("Error fetching folders:",e)}finally{v(!1)}},[e]),U=async(e,a,t,s,r,i)=>{try{await T.from("system_logs").insert([{account_id:e||null,action:t,entity_type:"archive",entity_name:r,entity_id:a,status:s,description:i}])}catch(e){console.error("System log insert error:",e)}},$=async e=>{try{b(e);let a=await fetch(`/api/archive/get-folder-contents?folderId=${e.id}&dimensionId=${e.dimension_id}`);if(!a.ok)throw Error("Failed to fetch folder contents");let t=await a.json();w(t.structure),N(!0)}catch(e){console.error("Error fetching folder contents:",e)}},z=async e=>{try{C(e.id);let t=await fetch("/api/archive/local-archive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:e.id,dimensionId:e.dimension_id})});if(!t.ok)throw Error("Failed to create local archive");await U(a,e.id,"LOCAL_ARCHIVE","success",e.name,`The user has successfully archived the folder '${e.name}' to local archive.`);let s=await t.blob(),r=window.URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`${e.name}_local_archive.zip`,document.body.appendChild(i),i.click(),document.body.removeChild(i),M({type:"success",title:"Local Archiving",message:`The user has successfully archived the folder '${e.name}' to local archive`}),await S()}catch(t){console.error("Error creating local archive:",t),await U(a,e.id,"LOCAL_ARCHIVE","success",e.name,`The user has failed to local archive the folder '${e.name}'.`),M({type:"error",title:"Local Archiving",message:`The user has failed to local archive the folder '${e.name}'`})}finally{C(null)}},I=async e=>{try{if(P(e.id),!(await fetch("/api/archive/cloud-archive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:e.id,dimensionId:e.dimension_id})})).ok)throw Error("Failed to archive to cloud");await U(a,e.id,"CLOUD_ARCHIVE","success",e.name,`The user has successfully archived the folder '${e.name}' to the cloud archive.`),M({type:"success",title:"Local Archiving",message:`The user has successfully archived the folder '${e.name}' to cloud archive`}),await S()}catch(t){console.error("Error archiving to cloud:",t),M({type:"error",title:"Local Archiving",message:`The user has failed to archive the folder '${e.name}' to the cloud archive.`}),await U(a,e.id,"CLOUD_ARCHIVE","success",e.name,`The user has failed to archive the folder '${e.name}' to the cloud archive.`)}finally{P(null)}},F=async e=>{if(confirm("Mark this folder as archived? Files will be deleted from the system."))try{if(L(e.id),!(await fetch("/api/archive/mark-archived",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:e.id,dimensionId:e.dimension_id})})).ok)throw Error("Failed to mark as archived");M({type:"success",title:"Mark as Archived",message:`The user has marked the folder '${e.name}' as Archived.`}),await U(a,e.id,"ARCHIVING_COMPLETED","success",e.name,`The user has marked the folder '${e.name}' as Archived.`),await S()}catch(a){console.error("Error marking as archived:",a),M({type:"error",title:"Mark as Archived",message:`The user has failed to mark as archived the folder '${e.name}'.`})}finally{L(null)}},R=e=>{let a=e.local_archive,t=e.cloud_archive;return a||t?a&&!t?(0,s.jsx)(d.A,{children:"Cloud Archive Needed"}):!a&&t?(0,s.jsx)(d.A,{children:"Local Archive Needed"}):(0,s.jsx)(d.A,{children:"Fully Archived"}):(0,s.jsx)(d.A,{children:"Not Archived"})},D=(e,a=0)=>e?(0,s.jsxs)("div",{style:{marginLeft:`${20*a}px`},className:"py-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["folder"===e.type?(0,s.jsx)(o.A,{className:"h-4 w-4 text-blue-500"}):(0,s.jsx)(c.A,{className:"h-4 w-4 text-gray-500"}),(0,s.jsxs)("span",{className:"text-sm",children:[e.name,e.size&&(0,s.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",(e.size/1024/1024).toFixed(2)," MB)"]})]})]}),e.children?.map(e=>D(e,a+1))]},`${e.type}-${e.id}`):null;return g?(0,s.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,s.jsx)(h.A,{className:"h-8 w-8 animate-spin"})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Archiving Management"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage folders marked for archiving"})]}),0===t.length?(0,s.jsx)(l.Zp,{children:(0,s.jsx)(l.Wu,{className:"pt-6",children:(0,s.jsx)("p",{className:"text-center text-muted-foreground",children:"No folders marked for archiving"})})}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Folder Name"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Dimension"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"View Contents"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Local Archive"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Cloud Archive"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Status"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 font-semibold",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>(0,s.jsxs)("tr",{className:"border-b hover:bg-muted/50",children:[(0,s.jsx)("td",{className:"py-3 px-4",children:e.name}),(0,s.jsx)("td",{className:"py-3 px-4",children:e.dimensions?.name||"N/A"}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)(i.A,{variant:"outline",size:"sm",onClick:()=>$(e),children:"See Files"})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)(i.A,{size:"sm",onClick:()=>z(e),disabled:A===e.id||e.local_archive,children:[A===e.id?(0,s.jsx)(h.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2"}),e.local_archive?"Downloaded":"Download"]})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)(i.A,{size:"sm",onClick:()=>I(e),disabled:_===e.id||e.cloud_archive,children:[_===e.id?(0,s.jsx)(h.A,{className:"h-4 w-4 animate-spin mr-2"}):(0,s.jsx)(p,{className:"h-4 w-4 mr-2"}),e.cloud_archive?"Uploaded":"Upload"]})}),(0,s.jsx)("td",{className:"py-3 px-4",children:R(e)}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsxs)(i.A,{size:"sm",onClick:()=>F(e),disabled:E===e.id||!e.local_archive||!e.cloud_archive,children:[E===e.id?(0,s.jsx)(h.A,{className:"h-4 w-4 animate-spin mr-2"}):null,"Mark Archived"]})})]},e.id))})]})}),(0,s.jsx)(n.lG,{open:k,onOpenChange:N,children:(0,s.jsxs)(n.Cf,{className:"max-w-2xl max-h-96 overflow-auto bg-white dark:bg-gray-950",children:[(0,s.jsxs)(n.c7,{children:[(0,s.jsxs)(n.L3,{children:["Folder Contents: ",y?.name]}),(0,s.jsx)(n.rr,{children:"View all files and subfolders"})]}),(0,s.jsx)("div",{className:"p-4 bg-muted rounded-lg overflow-auto",children:D(j)})]})})]})}}};var a=require("../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[7719,3607,4999,4386,1234,1931,8180,8557,1980],()=>t(42836));module.exports=s})();