(()=>{var e={};e.id=2917,e.ids=[2917],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9997:(e,s,r)=>{"use strict";r.d(s,{ContentTableShared:()=>P});var t=r(60687),a=r(43210),i=r(16189),l=r(11860),d=r(54220),n=r(16023),o=r(94676),c=r(189),m=r(28949),h=r(65992),x=r(33942),f=r(81904),p=r(31158),u=r(63143),g=r(88233),_=r(78201),v=r(29523),j=r(21342),b=r(59534),w=r(72314),y=r(49315),N=r(59050),k=r(90368),C=r(14270),S=r(9341),A=r(30474);function I({files:e,currentFolderId:s,isSharedView:r=!1,accessLevel:l="view"}){let{user:d}=(0,y.A)(),n=(0,i.useRouter)(),[o,c]=(0,a.useState)(null),[m,h]=(0,a.useState)(null),[I,P]=(0,a.useState)(null),{addDownload:D,updateDownload:q}=(0,k.m)(),{moveItem:E,setMoveItem:F}=(0,x.a)(),[T,L]=(0,a.useState)(!1),R=e=>{switch(e?.toLowerCase()){case"pdf":return(0,t.jsx)(A.default,{src:"/images/icons/pdf.svg",alt:"PDF Icon",className:"w-10 h-10",width:10,height:10});case"docx":return(0,t.jsx)(A.default,{src:"/images/icons/doc-icon.svg",alt:"DOCX Icon",className:"w-7 h-7",width:10,height:10});case"pptx":return(0,t.jsx)(A.default,{src:"/images/icons/ppt-icon.svg",alt:"PPTX Icon",className:"w-10 h-10",width:10,height:10});case"xlsx":return(0,t.jsx)(A.default,{src:"/images/icons/excel-icon.svg",alt:"XLSX Icon",className:"w-10 h-10",width:10,height:10});case"txt":return(0,t.jsx)(A.default,{src:"/images/icons/txt-icon.svg",alt:"TXT Icon",className:"w-10 h-10",width:10,height:10});default:return(0,t.jsx)(A.default,{src:"/images/icons/txt-icon.svg",alt:"Default Icon",className:"w-10 h-10",width:10,height:10})}},M=async e=>{let s=D({name:e.name,type:"file"});try{q(s,{status:"downloading",progress:10}),q(s,{progress:30});let r=await fetch(`/api/files/download?path=${encodeURIComponent(e.file_path)}`);if(!r.ok)throw Error("Failed to download file");q(s,{progress:70});let t=await r.blob(),a=URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=e.name,document.body.appendChild(i),i.click(),URL.revokeObjectURL(a),document.body.removeChild(i),q(s,{status:"completed",progress:100})}catch(e){console.error("Error downloading file:",e),q(s,{status:"error",error:e instanceof Error?e.message:"Download failed"})}};return 0===e.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"There are currently no FILES."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-white/5 dark:bg-white/3",children:(0,t.jsx)("div",{className:"max-w-full overflow-x-auto",children:(0,t.jsx)("div",{className:"min-w-[1102px]",children:(0,t.jsxs)(b.XI,{children:[(0,t.jsx)(b.A0,{className:"border-b border-gray-100 dark:border-white/5",children:(0,t.jsxs)(b.Hj,{children:[(0,t.jsx)(b.nA,{className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Document"}),(0,t.jsx)(b.nA,{className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Dimension"}),(0,t.jsx)(b.nA,{className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Access Level"}),(0,t.jsx)(b.nA,{className:"px-5 py-3 font-medium text-gray-500 text-start text-theme-xs dark:text-gray-400",children:"Shared Date"}),(0,t.jsx)(b.nA,{className:"px-5 py-3 font-medium text-gray-500 text-center text-theme-xs dark:text-gray-400",children:"Actions"})]})}),(0,t.jsx)(b.BF,{className:"divide-y divide-gray-100 dark:divide-white/5",children:e.map(e=>(0,t.jsxs)(b.Hj,{children:[(0,t.jsx)(b.nA,{className:"px-5 py-4 sm:px-6 text-start",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 flex items-center",children:R(e?.name.split(".").pop())}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"block font-medium text-gray-800 text-theme-sm dark:text-white/90",children:e.name}),(0,t.jsx)("span",{className:"block text-gray-500 text-theme-xs dark:text-gray-400",children:e.folder?.name||"-"})]})]})}),(0,t.jsx)(b.nA,{className:"px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400",children:e.shared_info?.shared_from_dimension?.name||"—"}),(0,t.jsx)(b.nA,{className:"px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400",children:(0,t.jsx)(C.A,{variant:"full_access"===(e.shared_info?.access_level||l)?"solid":"light",children:"full_access"===(e.shared_info?.access_level||l)?"Full Access":"View Only"})}),(0,t.jsx)(b.nA,{className:"px-4 py-3 text-gray-500 text-start text-theme-sm dark:text-gray-400",children:e.shared_info?.created_at?(0,_.m)(new Date(e.shared_info.created_at),{addSuffix:!0}):"—"}),(0,t.jsx)(b.nA,{className:"px-4 py-3 text-gray-500 text-theme-sm dark:text-gray-400",children:(0,t.jsxs)(j.rI,{children:[(0,t.jsx)(j.ty,{asChild:!0,children:(0,t.jsxs)(v.$,{variant:"ghost",size:"icon",children:[(0,t.jsx)(f.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Actions"})]})}),(0,t.jsxs)(j.SQ,{align:"end",className:"p-4",children:[(0,t.jsxs)(j._2,{onClick:()=>M(e),children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Download"]}),(e.shared_info?.access_level??l)==="full_access"&&(0,t.jsxs)(j._2,{onClick:()=>h(e),children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Rename"]}),(e.shared_info?.access_level??l)==="full_access"&&(0,t.jsxs)(j._2,{className:"text-destructive",onClick:()=>P(e),children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},e.id))})]})})})}),m&&(0,t.jsx)(S.A,{isOpen:!!m,onClose:()=>h(null),itemType:"file",itemId:m.id,currentName:m.name,onSuccess:()=>{n.refresh()}}),I&&(0,t.jsx)(w.A,{isOpen:!!I,onClose:()=>P(null),itemType:"file",itemId:I.id,itemName:I.name,onSuccess:()=>{n.refresh()}}),o&&(0,t.jsx)(N.Z,{isOpen:!!o,onClose:()=>c(null),itemType:"file",itemId:o.id,itemName:o.name,currentDimensionId:o.dimension_id,onSuccess:()=>{n.refresh()}})]})}function P({folders:e,files:s,dimensionId:r,dimensionSlug:f,currentFolderId:p,isSharedView:u=!1,sharedFromDimensionId:g,accessLevel:_="view"}){let v=(0,i.useRouter)(),[j,b]=(0,a.useState)(!1),[w,y]=(0,a.useState)(!1),[N,k]=(0,a.useState)(""),[C,S]=(0,a.useState)({field:"name",order:"asc"}),{moveItem:A,setMoveItem:P}=(0,x.a)(),[D,q]=(0,a.useState)(!1),[E,F]=(0,a.useState)(1),T=(0,a.useMemo)(()=>N.trim()?s.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())):s,[s,N]),L=(0,a.useMemo)(()=>{let e=[...T];switch(C.field){case"name":e.sort((e,s)=>e.name.localeCompare(s.name));break;case"type":e.sort((e,s)=>(e.file_type||"").localeCompare(s.file_type||""));break;case"size":e.sort((e,s)=>e.file_size-s.file_size);break;case"date":e.sort((e,s)=>new Date(e.created_at).getTime()-new Date(s.created_at).getTime())}return"desc"===C.order&&e.reverse(),e},[T,C]),R=Math.ceil(L.length/10);return(0,a.useMemo)(()=>{let e=(E-1)*10;return L.slice(e,e+10)},[L,E]),(0,t.jsxs)("div",{className:"space-y-6",children:[A&&(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Moving ",A.type,": ",(0,t.jsx)("span",{className:"font-semibold",children:A.name})]})}),(0,t.jsx)(o.A,{onClick:()=>P(null),className:"h-6 w-6 p-0 flex items-center justify-center",children:(0,t.jsx)(l.A,{className:"h-4 w-4 text-gray-700 dark:text-white"})})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"relative flex gap-4 mb-8 items-center justify-end",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute -translate-y-1/2 left-4 top-1/2 pointer-events-none",children:(0,t.jsx)("svg",{className:"fill-gray-500 dark:fill-gray-400",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.04175 9.37363C3.04175 5.87693 5.87711 3.04199 9.37508 3.04199C12.8731 3.04199 15.7084 5.87693 15.7084 9.37363C15.7084 12.8703 12.8731 15.7053 9.37508 15.7053C5.87711 15.7053 3.04175 12.8703 3.04175 9.37363ZM9.37508 1.54199C5.04902 1.54199 1.54175 5.04817 1.54175 9.37363C1.54175 13.6991 5.04902 17.2053 9.37508 17.2053C11.2674 17.2053 13.003 16.5344 14.357 15.4176L17.177 18.238C17.4699 18.5309 17.9448 18.5309 18.2377 18.238C18.5306 17.9451 18.5306 17.4703 18.2377 17.1774L15.418 14.3573C16.5365 13.0033 17.2084 11.2669 17.2084 9.37363C17.2084 5.04817 13.7011 1.54199 9.37508 1.54199Z",fill:""})})}),(0,t.jsx)("input",{type:"search",placeholder:"Search folders...",value:N,onChange:e=>k(e.target.value),className:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-200 bg-transparent py-2.5 pl-12 pr-14 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-white dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 xl:w-[430px]"})]}),(0,t.jsxs)(o.A,{variant:"outline",onClick:()=>y(!0),className:"flex items-center gap-1",children:[(0,t.jsx)(d.A,{className:"h-4 w-4 mr-1"}),"Sort"]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-medium",children:"Files"}),(0,t.jsx)("div",{className:"flex gap-4",children:"full_access"===_&&(0,t.jsxs)(o.A,{onClick:()=>b(!0),children:[(0,t.jsx)(n.A,{className:"h-4 w-4 mr-2"}),"Upload File"]})})]})]}),(0,t.jsx)(I,{files:L,isSharedView:u,currentFolderId:p,accessLevel:_}),R>=1&&(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(h.A,{currentPage:E,totalPages:R,onPageChange:e=>F(e)})}),(0,t.jsx)(c.r,{isOpen:j,onClose:()=>b(!1),dimensionId:g,currentFolderId:p,onSuccess:()=>v.refresh()}),(0,t.jsx)(m.X,{isOpen:w,onClose:()=>y(!1),options:C,onSort:S,title:"Sort Files",availableFields:["name","type","size","date"]})]})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},40596:(e,s,r)=>{Promise.resolve().then(r.bind(r,53848)),Promise.resolve().then(r.bind(r,59739)),Promise.resolve().then(r.bind(r,9997))},49821:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>m,metadata:()=>c});var t=r(37413),a=r(39916),i=r(76033),l=r(85649),d=r(59904),n=r(76076),o=r(56007);let c={title:"eSBMexico SBM Shared Documents | MNHS",description:"This  "};async function m({params:e}){let{folderPath:s=[]}=await e,r=await (0,i.U)(),{data:{user:c},error:m}=await r.auth.getUser();(m||!c)&&(0,a.redirect)("/login");let{data:h,error:x}=await r.from("admins").select("*").eq("id",c.id).single();if(x||!h||!h.assigned_dimension_id)return(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Shared with me"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"You need to be assigned to a dimension to view shared files."})]});let f=h.id,p=h.assigned_dimension_id,u=null,g=[];if(s.length>0){u=Number.parseInt(s[s.length-1],10);let{data:e}=await r.from("folders").select("id, name, parent_folder_id, dimension_id").eq("id",u).single();if(e){let s=!1,t=null,{data:i}=await r.from("shared_items").select("*").eq("item_type","folder").eq("item_id",u).eq("shared_to_dimension_id",p).single();if(i)s=!0,t=u;else{let a=e;for(;a.parent_folder_id&&!s;){let{data:e}=await r.from("shared_items").select("*").eq("item_type","folder").eq("item_id",a.parent_folder_id).eq("shared_to_dimension_id",p).single();if(e){s=!0,t=a.parent_folder_id;break}let{data:i}=await r.from("folders").select("id, name, parent_folder_id, dimension_id").eq("id",a.parent_folder_id).single();if(!i)break;a=i}}s||(0,a.notFound)();let l=e,d=[{id:l.id,name:l.name,path:`/dashboard/shared/${l.id}`}];for(;l.parent_folder_id&&l.parent_folder_id!==t;){let{data:e}=await r.from("folders").select("id, name, parent_folder_id, dimension_id").eq("id",l.parent_folder_id).single();if(e)d.unshift({id:e.id,name:e.name,path:`/dashboard/shared/${e.id}`}),l=e;else break}if(t&&l.parent_folder_id===t){let{data:e}=await r.from("folders").select("id, name, parent_folder_id, dimension_id").eq("id",t).single();e&&d.unshift({id:e.id,name:e.name,path:`/dashboard/shared/${e.id}`})}g=d}}let _="view",v=null;if(null!==u&&!isNaN(u)){let{data:e,error:s}=await r.from("shared_items").select("access_level, shared_from_dimension_id").eq("item_type","folder").eq("item_id",u).eq("shared_to_dimension_id",p).maybeSingle();if(s&&console.error("Error fetching shared info for current folder:",s),e)_=e.access_level,v=e.shared_from_dimension_id;else{let e=u,s=null,t=null;for(;e&&!s;){let{data:a}=await r.from("folders").select("parent_folder_id").eq("id",e).maybeSingle();if(!a?.parent_folder_id)break;let{data:i}=await r.from("shared_items").select("access_level, shared_from_dimension_id").eq("item_type","folder").eq("item_id",a.parent_folder_id).eq("shared_to_dimension_id",p).maybeSingle();if(i){s=i.access_level,t=i.shared_from_dimension_id;break}e=a.parent_folder_id}s&&(_=s,v=t)}}console.log("\uD83E\uDDE9 Folder ID:",u),console.log("\uD83D\uDD10 Final access level:",_),console.log("\uD83C\uDFF7️ Shared to dimension ID:",v);let j=[],b=[];if(null===u){let{data:e,error:s}=await r.from("shared_items").select(`
        id,
        item_id,
        item_type,
        access_level,
        created_at,
        shared_from_dimension:dimensions!shared_items_shared_from_dimension_id_fkey(id, name, slug)
      `).eq("item_type","folder").eq("shared_to_dimension_id",p);if(s&&console.error("Error fetching shared folders:",s),e&&e.length>0){let s=e.map(e=>e.item_id),{data:t}=await r.from("folders").select("*").in("id",s).order("name");j=(t||[]).map(s=>({...s,shared_info:e?.find(e=>e.item_id===s.id)||null}))}let{data:t,error:a}=await r.from("shared_items").select(`
        id,
        item_id,
        item_type,
        access_level,
        created_at,
        shared_from_dimension:dimensions!shared_items_shared_from_dimension_id_fkey(id, name, slug)
      `).eq("item_type","file").eq("shared_to_dimension_id",p);if(a&&console.error("Error fetching shared files:",a),t&&t.length>0){let e=t.map(e=>e.item_id),{data:s}=await r.from("files").select("*").in("id",e).order("name");b=(s||[]).map(e=>({...e,shared_info:t?.find(s=>s.item_id===e.id)||null}))}}else{let{data:e,error:s}=await r.from("folders").select("*").eq("parent_folder_id",u).order("name");s&&console.error("Error fetching child folders:",s),j=e||[];let{data:t,error:a}=await r.from("files").select("*").eq("folder_id",u).order("name");a&&console.error("Error fetching files:",a),b=t||[]}return(0,t.jsxs)("div",{children:[(0,t.jsx)(d.A,{pageTitle:"Shared Documents"}),(0,t.jsx)("div",{className:"h-fit rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/3 xl:px-10 xl:py-12",children:(0,t.jsxs)("div",{className:"mx-auto w-full text-center",children:[(0,t.jsx)("div",{className:"mb-10",children:(0,t.jsx)(l.BreadcrumbNav,{items:g,dimensionSlug:"shared",isSharedPage:!0})}),(0,t.jsx)(n.ContentExplorerShared,{folders:j,files:b,dimensionId:p,currentUserId:f.id,dimensionSlug:"shared",currentFolderId:u,isSharedView:!0,accessLevel:_,sharedFromDimensionId:v})]})}),(0,t.jsx)("div",{className:"h-fit rounded-2xl border mt-6 border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/3 xl:px-10 xl:py-12",children:(0,t.jsx)("div",{className:"mx-auto w-full text-center",children:(0,t.jsx)(o.ContentTableShared,{folders:j,files:b,dimensionId:p,dimensionSlug:"shared",currentFolderId:u,isSharedView:!0,accessLevel:_,sharedFromDimensionId:v})})})]})}},56007:(e,s,r)=>{"use strict";r.d(s,{ContentTableShared:()=>t});let t=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call ContentTableShared() from the server but ContentTableShared is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\components\\dashboard\\content-table-shared.tsx","ContentTableShared")},59739:(e,s,r)=>{"use strict";r.d(s,{ContentExplorerShared:()=>A});var t=r(60687),a=r(43210),i=r(16189),l=r(1171),d=r(28949),n=r(11860),o=r(54220),c=r(94676),m=r(33942),h=r(85814),x=r.n(h),f=r(44493),p=r(21342),u=r(81904),g=r(31158),_=r(63143),v=r(88233),j=r(72314),b=r(49315),w=r(30474),y=r(59050),N=r(29523),k=r(90368),C=r(9341);function S({folders:e,dimensionSlug:s,dimensionId:r,isSharedView:l=!1,accessLevel:d="view"}){let n=(0,i.useRouter)(),{user:o}=(0,b.A)(),[c,h]=(0,a.useState)(null),[S,A]=(0,a.useState)(null),[I,P]=(0,a.useState)(null),[D,q]=(0,a.useState)(!1),[E,F]=(0,a.useState)(null),[T,L]=(0,a.useState)(new Set),{addDownload:R,updateDownload:M}=(0,k.m)(),{moveItem:U,setMoveItem:O}=(0,m.a)(),[z,$]=(0,a.useState)(!1),X=async(e,s)=>{s.preventDefault(),s.stopPropagation(),q(!0),A(e);try{let s=await fetch(`/api/folders/nested-counts?folderId=${e.id}`);if(!s.ok)throw Error("Failed to fetch nested counts");let r=await s.json();P(r)}catch(e){console.error("Error fetching nested counts:",e),P({folders:0,files:0})}finally{q(!1)}};if(0===e.length)return(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No folders found."});let B=async(e,s)=>{let t=R({name:`${e.name}.zip`,type:"folder"});try{M(t,{status:"downloading",progress:5});let a=await fetch(`/api/folders/download?folderId=${e.id}&dimensionId=${s??r}`);if(!a.ok)throw Error("Failed to download folder");M(t,{progress:30});let i=a.headers.get("content-length"),l=i?Number.parseInt(i,10):0,d=0,n=a.body?.getReader(),o=[];if(n)for(;;){let{done:e,value:s}=await n.read();if(e)break;if(o.push(s),d+=s.length,l>0){let e=Math.min(30+d/l*60,90);M(t,{progress:e})}}M(t,{progress:95});let c=new Blob(o,{type:"application/zip"}),m=URL.createObjectURL(c),h=document.createElement("a");h.href=m,h.download=`${e.name}.zip`,document.body.appendChild(h),h.click(),URL.revokeObjectURL(m),document.body.removeChild(h),M(t,{status:"completed",progress:100})}catch(e){console.error("Error downloading folder:",e),M(t,{status:"error",error:e instanceof Error?e.message:"Download failed"})}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:e.map(e=>(0,t.jsx)(f.Zp,{className:"group hover:border-primary/50 transition-colors",children:(0,t.jsxs)(f.Wu,{className:"p-0 relative",children:[(e.shared_info?.access_level??d)==="full_access"&&(0,t.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,t.jsxs)(p.rI,{children:[(0,t.jsx)(p.ty,{asChild:!0,children:(0,t.jsxs)(N.$,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[(0,t.jsx)(u.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Actions"})]})}),(0,t.jsxs)(p.SQ,{align:"end",className:"p-4",children:[(0,t.jsxs)(p._2,{onClick:s=>{s.preventDefault(),s.stopPropagation();let r=e.shared_info?.shared_from_dimension?.id;B(e,r)},disabled:T.has(e.id),children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Download"]}),(0,t.jsxs)(p._2,{onClick:s=>{s.preventDefault(),s.stopPropagation(),h(e)},children:[(0,t.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Rename"]}),(0,t.jsxs)(p._2,{className:"text-destructive",onClick:s=>X(e,s),children:[(0,t.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}),(0,t.jsxs)(x(),{href:`/dashboard/${s}/${e.id}`,className:"block py-6 px-6 h-full",children:[(0,t.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-12 h-12 bg-gray-100 rounded-xl dark:bg-gray-600",children:(0,t.jsx)(w.default,{width:50,height:40,src:"/images/icons/folder.svg",className:"h-[30px] w-[30px]",alt:"folder"})}),(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{children:(0,t.jsx)("h3",{className:"text-sm text-start text-gray-800 dark:text-gray-200",children:e.name})})})]}),(0,t.jsx)("div",{className:"flex flex-row items-center justify-between mt-4",children:e.shared_info&&(0,t.jsxs)("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,t.jsx)("span",{className:"capitalize",children:(e.shared_info?.access_level??d)==="full_access"?"Full Access":"View Only"}),(0,t.jsxs)(t.Fragment,{children:[" • ",(0,t.jsxs)("span",{children:["Shared by ",e.shared_info?.shared_from_dimension?.name]})]})]})})]})]})},e.id))}),c&&(0,t.jsx)(C.A,{isOpen:!!c,onClose:()=>h(null),itemType:"folder",itemId:c.id,currentName:c.name,onSuccess:()=>{n.refresh()}}),S&&(0,t.jsx)(j.A,{isOpen:!!S,onClose:()=>{A(null),P(null)},itemType:"folder",itemId:S.id,itemName:S.name,nestedCounts:I||void 0,onSuccess:()=>{n.refresh()}}),E&&(0,t.jsx)(y.Z,{isOpen:!!E,onClose:()=>F(null),itemType:"folder",itemId:E.id,itemName:E.name,currentDimensionId:E.dimension_id,onSuccess:()=>{n.refresh()}})]})}function A({folders:e,files:s,dimensionId:r,currentUserId:h,dimensionSlug:x,currentFolderId:f,isSharedView:p=!1,sharedFromDimensionId:u,accessLevel:g="view"}){let _=(0,i.useRouter)(),[v,j]=(0,a.useState)(!1),[b,w]=(0,a.useState)(!1),[y,N]=(0,a.useState)(""),[k,C]=(0,a.useState)({field:"name",order:"asc"}),A=(0,a.useMemo)(()=>y.trim()?e.filter(e=>e.name.toLowerCase().includes(y.toLowerCase())):e,[e,y]),I=(0,a.useMemo)(()=>{let e=[...A];return"name"===k.field?e.sort((e,s)=>e.name.localeCompare(s.name)):"date"===k.field&&e.sort((e,s)=>new Date(e.updated_at).getTime()-new Date(s.updated_at).getTime()),"desc"===k.order&&e.reverse(),e},[A,k]),{moveItem:P,setMoveItem:D}=(0,m.a)(),[q,E]=(0,a.useState)(!1),F=async()=>{if(P&&"folder"===P.type){E(!0);try{let e=await fetch("/api/folders/move",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:P.id,targetParentFolderId:f||null})});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to move folder")}D(null),_.refresh()}catch(e){console.error("Error moving folder:",e),alert(`Error moving folder: ${e.message}`)}finally{E(!1)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[P&&(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-4 flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("span",{className:"text-sm font-medium",children:["Moving ",P.type,": ",(0,t.jsx)("span",{className:"font-semibold",children:P.name})]})}),(0,t.jsx)(c.A,{onClick:()=>D(null),className:"h-6 w-6 p-0 flex items-center justify-center",children:(0,t.jsx)(n.A,{className:"h-4 w-4 text-gray-700 dark:text-white"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"relative flex flex-row gap-4 mb-8 items-center justify-end",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute -translate-y-1/2 left-4 top-1/2 pointer-events-none",children:(0,t.jsx)("svg",{className:"fill-gray-500 dark:fill-gray-400",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.04175 9.37363C3.04175 5.87693 5.87711 3.04199 9.37508 3.04199C12.8731 3.04199 15.7084 5.87693 15.7084 9.37363C15.7084 12.8703 12.8731 15.7053 9.37508 15.7053C5.87711 15.7053 3.04175 12.8703 3.04175 9.37363ZM9.37508 1.54199C5.04902 1.54199 1.54175 5.04817 1.54175 9.37363C1.54175 13.6991 5.04902 17.2053 9.37508 17.2053C11.2674 17.2053 13.003 16.5344 14.357 15.4176L17.177 18.238C17.4699 18.5309 17.9448 18.5309 18.2377 18.238C18.5306 17.9451 18.5306 17.4703 18.2377 17.1774L15.418 14.3573C16.5365 13.0033 17.2084 11.2669 17.2084 9.37363C17.2084 5.04817 13.7011 1.54199 9.37508 1.54199Z",fill:""})})}),(0,t.jsx)("input",{type:"search",placeholder:"Search folders...",value:y,onChange:e=>N(e.target.value),className:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-200 bg-transparent py-2.5 pl-12 pr-14 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-white dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 xl:w-[430px]"})]}),(0,t.jsxs)(c.A,{variant:"outline",onClick:()=>w(!0),className:"flex items-center gap-1",children:[(0,t.jsx)(o.A,{className:"h-4 w-4 mr-1"}),"Sort"]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-medium",children:"Folders"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[P&&"folder"===P.type&&(0,t.jsx)(c.A,{onClick:F,disabled:q,size:"sm",children:q?"Moving...":"Move here"}),"full_access"===g&&(0,t.jsx)(l.V,{dimensionId:u,parentFolderId:f,createdBy:h})]})]})]}),(0,t.jsx)(S,{folders:I,dimensionSlug:x,dimensionId:u,isSharedView:p,accessLevel:g})]}),(0,t.jsx)(d.X,{isOpen:b,onClose:()=>w(!1),options:k,onSort:C,title:"Sort Folders",availableFields:["name","date"]})]})}},62974:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>l.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>o});var t=r(65239),a=r(48088),i=r(88170),l=r.n(i),d=r(30893),n={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);r.d(s,n);let o={children:["",{children:["dashboard",{children:["shared",{children:["[[...folderPath]]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,49821)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\shared\\[[...folderPath]]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,63144)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,54413)),"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\app\\dashboard\\shared\\[[...folderPath]]\\page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},h=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/shared/[[...folderPath]]/page",pathname:"/dashboard/shared/[[...folderPath]]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76076:(e,s,r)=>{"use strict";r.d(s,{ContentExplorerShared:()=>t});let t=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call ContentExplorerShared() from the server but ContentExplorerShared is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\Jave\\Desktop\\research\\esbmexico\\src\\components\\dashboard\\content-explorer-shared.tsx","ContentExplorerShared")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80916:(e,s,r)=>{Promise.resolve().then(r.bind(r,85649)),Promise.resolve().then(r.bind(r,76076)),Promise.resolve().then(r.bind(r,56007))}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[7719,3607,4999,4386,1234,1931,5902,4647,8201,4557,8180,8557,1980,4901,8202],()=>r(62974));module.exports=t})();